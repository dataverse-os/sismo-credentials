//SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.17;

import "forge-std/Test.sol";
import {SismoCredential} from "../src/SismoCredential.sol";
import {BaseTest} from "./base/BaseTest.t.sol";
import {DataTypes} from "../src/libraries/DataTypes.sol";

contract SismoCredentialsTest is BaseTest {
    SismoCredential public sismoCredential;
    // with 1 credential
    bytes response =
        hex"00000000000000000000000000000000000000000000000000000000000000201267ea070ec44221e85667a731eee04500000000000000000000000000000000b8e2054f8a912367e38a22ce773328ff000000000000000000000000000000007369736d6f2d636f6e6e6563742d76312e31000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000b5ab443dff53f0e397a9e0778a3343cbaf4d001a00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001a068796472612d73332e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000004a0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011ced80673868b95a4e1e17b846881eedfd35ab926b3a90f6390a8af8027678e600000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c02996d7241972fe32f3555df00c67df504b31fa62abd3fdec05b33a1e9bd40f001a164a5029b39b1951de219435490509adf7c59fb2ea2d4acb46248c484ebcf01b91327b6e334d520f76611786944fd33228614faf78e9e1d89fc114fbfb121b251782181b0c691304ed4975863f2f13d96e3146a73f042a0153fd6445632b8025f92d8fbb89967bfe51ff910f0adf67085e5a46c895fe2e73556328405c6e0b197e049b532c2f809cf96324adfcf5621ff0662944db6a28a13b73b3ffa1663301069c7e58ed0d4623a87017beb865ae9d76af12c94259258d75f16b5e26263f2ed75273c66451bc121b8d0cec841b4ae8b788e9448324168159b29ffaff0edd000000000000000000000000000000000000000000000000000000000000000002b8a512b4aaebb2955485bc52ef1c2957ab167b3784a33ff5dff93ce2cc8e8b07f6c5612eb579788478789deccb06cf0eb168e457eea490af754922939ebdb920706798455f90ed993f8dac8075fc1538738a25f0c928da905c0dffd81869fa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001ced80673868b95a4e1e17b846881eedfd35ab926b3a90f6390a8af8027678e617deb519a568cd1e54da8d268b86077d4e3d1cbe735d60461ac36a99654bca9000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73332e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000f44c3e70f9147f1a4d59077451535f00000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c005d10e141b21b4448a1b3f49d1338ffc9f50c729fdb685e0505ae9e5b439afd91f39ed7e81a74b63b40c463c156b4c003238c070c5047421c8428353549bbb952cc958ab1f789ee32e921e29b8880396354295e23dd8cae3b2fe0e1397210c391b12df0199c8611da0368284009c1f6bf92c081876b31e6ca3244d5be03a4bab0191d19de27741860953c04406dd73ffefce065805483fad1166f4eab71bf9df00e5daae84809e7ac61f6937ede7d821f96973f5e4edd1c9ef5f82bbcf9094f2008e040ce0cd8570ebb972aaaba94eea54d745a9e9d9a384748c3c52cdaf90f105469e6e7039c4f89cb1fb1483c438b57a214645355a1275488f9cc4c097d8d3000000000000000000000000000000000000000000000000000000000000000002b8a512b4aaebb2955485bc52ef1c2957ab167b3784a33ff5dff93ce2cc8e8b07f6c5612eb579788478789deccb06cf0eb168e457eea490af754922939ebdb920706798455f90ed993f8dac8075fc1538738a25f0c928da905c0dffd81869fa18391ee25ac526ca3e3310d295a3801e9b67d4cd0c8fbf3715b840f7229bd4ca2b4d048d74ba4392342fcd8decf07742556ec7fae4eb17ff51e181f94fcfb48d143bf633750b17355486194a660c7cf29c7c05130a47fa78fde5cd2897e236f900000000000000000000000000000000000000000000000000000000000000010256b632931c5e49b3c7aae3c9cca52ea35deafb12d4cd29ac96341c4ffffffb00000000000000000000000000000000000000000000000000000000000000001ced80673868b95a4e1e17b846881eedfd35ab926b3a90f6390a8af8027678e617deb519a568cd1e54da8d268b86077d4e3d1cbe735d60461ac36a99654bca90000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";

    bytes response2 =
        hex"00000000000000000000000000000000000000000000000000000000000000201267ea070ec44221e85667a731eee04500000000000000000000000000000000b8e2054f8a912367e38a22ce773328ff000000000000000000000000000000007369736d6f2d636f6e6e6563742d76312e31000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000b5ab443dff53f0e397a9e0778a3343cbaf4d001a0000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000005200000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001a068796472612d73332e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000004a0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011ced80673868b95a4e1e17b846881eedfd35ab926b3a90f6390a8af8027678e600000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c02fd0c47516203661f1267d36b5f6c0bc28251327926e3d3e00ea1666bd18758b139ab0a52f71f9c4a50fae1c9f110256ddb4b913d1ebd66035bf18a1eb70a26727e020e61a00016456185780af81dd6bc0bed5095ce21454a6afcabe8f1c0513066f0af71b930b1874b0365f5b1816404edd796e5a423fc06bb6ca851d572a3917c0bca08817549c9c34f1f66b188199b69925baed1a283cdf7f790e5c34001304d75016fd41fb7f44ad37dd4768ddc95c52c3b590cc167d1b837f8b3f84ac721e1e32905e826f6b55ba35b76221a785229054b93a915db858e5b9c2f5c36f5d197d3677a5348cf03db0df132598f39791fe1f5134b0a4a2bc621de6cb83cceb000000000000000000000000000000000000000000000000000000000000000002b8a512b4aaebb2955485bc52ef1c2957ab167b3784a33ff5dff93ce2cc8e8b07f6c5612eb579788478789deccb06cf0eb168e457eea490af754922939ebdb920706798455f90ed993f8dac8075fc1538738a25f0c928da905c0dffd81869fa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001ced80673868b95a4e1e17b846881eedfd35ab926b3a90f6390a8af8027678e617deb519a568cd1e54da8d268b86077d4e3d1cbe735d60461ac36a99654bca9000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73332e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000f44c3e70f9147f1a4d59077451535f00000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c01b21efc89f60c8ce83ba0a805c1c3f0fe8643fe952b5607b0421234b5601ee48299756dd1df5f0a5be2c8b9081834e7597f24f37d0f7a878444cee451093906618ba1a9174ff7fec46f3cd2e8a960477a40dc477add41cf2e660086247918fa11f7c6cf351623a73ab02371ff673568806ebd8ace29a0675651a0db39318604f09de67072f53724024882d5f22fc1cd25e642d6142f13a2e747f40b2c15925dc2edb1fafd940aa0acf3b5220cf247cff8903d739ab380cdca7cb2a29453a445619f585a6fcfd424fb18101de3e6e3b95962eb01fbe4c458cdeba8dff2290f1b525392fc29619797a943aad9d5b5a122f7f63c03aad718a2b3f6c9594b22c978b000000000000000000000000000000000000000000000000000000000000000002b8a512b4aaebb2955485bc52ef1c2957ab167b3784a33ff5dff93ce2cc8e8b07f6c5612eb579788478789deccb06cf0eb168e457eea490af754922939ebdb920706798455f90ed993f8dac8075fc1538738a25f0c928da905c0dffd81869fa18391ee25ac526ca3e3310d295a3801e9b67d4cd0c8fbf3715b840f7229bd4ca2b4d048d74ba4392342fcd8decf07742556ec7fae4eb17ff51e181f94fcfb48d143bf633750b17355486194a660c7cf29c7c05130a47fa78fde5cd2897e236f900000000000000000000000000000000000000000000000000000000000000010256b632931c5e49b3c7aae3c9cca52ea35deafb12d4cd29ac96341c4ffffffb00000000000000000000000000000000000000000000000000000000000000001ced80673868b95a4e1e17b846881eedfd35ab926b3a90f6390a8af8027678e617deb519a568cd1e54da8d268b86077d4e3d1cbe735d60461ac36a99654bca9000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73332e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000007cccd0183c6ca02e76600996a671a824000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c009add86b6daa5011b8d13f3fc7b30a36412f30e55163519825119261fe769f182c50fe65cdd7094e98a8ff818975ee2280df7d1043b256442d9817233ab9ad6917715e4c7f1afe893801288750c8fc278d8a144518a93e1238ac4be7f50526b4132a4e24d08339c6bd22e6f791ee5f2543d8e0a7c8b309017c8f39b6e134da9a05a494966b704b467cb3b6c91d8e37af94173d6e1b68931c7a74ebc287aa0f63117015cb66a82f11cfd4d573c1b63641a5c89f6f218905411697bb660b8c9b3828ad5934e7c6fa4677a749987e50d5e55cf2b4f26db50ba78ea1373eb163bcfc082daee66c8e03721451e1654a2c42c5b6b9e1d340b80dd6c221c1ed5d24c968000000000000000000000000000000000000000000000000000000000000000002b8a512b4aaebb2955485bc52ef1c2957ab167b3784a33ff5dff93ce2cc8e8b07f6c5612eb579788478789deccb06cf0eb168e457eea490af754922939ebdb920706798455f90ed993f8dac8075fc1538738a25f0c928da905c0dffd81869fa18391ee25ac526ca3e3310d295a3801e9b67d4cd0c8fbf3715b840f7229bd4ca15f0c9d010d22cbd1a93eb450fb1c5189d696a739c5d9fb92eea292854b658c60b60307b2601517d751fe508d666838676b02e581a6bb9c3888e6ca33f98a4a700000000000000000000000000000000000000000000000000000000000000011c0433327a095fdb05bf7e29a36ef76a1bf9a3d480011edd783c14d81ffffffe00000000000000000000000000000000000000000000000000000000000000001ced80673868b95a4e1e17b846881eedfd35ab926b3a90f6390a8af8027678e617deb519a568cd1e54da8d268b86077d4e3d1cbe735d60461ac36a99654bca90000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";

    // with 2 credential
    bytes response3 =
        hex"00000000000000000000000000000000000000000000000000000000000000201267ea070ec44221e85667a731eee04500000000000000000000000000000000b8e2054f8a912367e38a22ce773328ff000000000000000000000000000000007369736d6f2d636f6e6e6563742d76312e31000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000b5ab443dff53f0e397a9e0778a3343cbaf4d001a0000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000005200000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001a068796472612d73332e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000004a0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011ced80673868b95a4e1e17b846881eedfd35ab926b3a90f6390a8af8027678e600000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c02fd0c47516203661f1267d36b5f6c0bc28251327926e3d3e00ea1666bd18758b139ab0a52f71f9c4a50fae1c9f110256ddb4b913d1ebd66035bf18a1eb70a26727e020e61a00016456185780af81dd6bc0bed5095ce21454a6afcabe8f1c0513066f0af71b930b1874b0365f5b1816404edd796e5a423fc06bb6ca851d572a3917c0bca08817549c9c34f1f66b188199b69925baed1a283cdf7f790e5c34001304d75016fd41fb7f44ad37dd4768ddc95c52c3b590cc167d1b837f8b3f84ac721e1e32905e826f6b55ba35b76221a785229054b93a915db858e5b9c2f5c36f5d197d3677a5348cf03db0df132598f39791fe1f5134b0a4a2bc621de6cb83cceb000000000000000000000000000000000000000000000000000000000000000002b8a512b4aaebb2955485bc52ef1c2957ab167b3784a33ff5dff93ce2cc8e8b07f6c5612eb579788478789deccb06cf0eb168e457eea490af754922939ebdb920706798455f90ed993f8dac8075fc1538738a25f0c928da905c0dffd81869fa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001ced80673868b95a4e1e17b846881eedfd35ab926b3a90f6390a8af8027678e617deb519a568cd1e54da8d268b86077d4e3d1cbe735d60461ac36a99654bca9000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73332e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000f44c3e70f9147f1a4d59077451535f00000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c01b21efc89f60c8ce83ba0a805c1c3f0fe8643fe952b5607b0421234b5601ee48299756dd1df5f0a5be2c8b9081834e7597f24f37d0f7a878444cee451093906618ba1a9174ff7fec46f3cd2e8a960477a40dc477add41cf2e660086247918fa11f7c6cf351623a73ab02371ff673568806ebd8ace29a0675651a0db39318604f09de67072f53724024882d5f22fc1cd25e642d6142f13a2e747f40b2c15925dc2edb1fafd940aa0acf3b5220cf247cff8903d739ab380cdca7cb2a29453a445619f585a6fcfd424fb18101de3e6e3b95962eb01fbe4c458cdeba8dff2290f1b525392fc29619797a943aad9d5b5a122f7f63c03aad718a2b3f6c9594b22c978b000000000000000000000000000000000000000000000000000000000000000002b8a512b4aaebb2955485bc52ef1c2957ab167b3784a33ff5dff93ce2cc8e8b07f6c5612eb579788478789deccb06cf0eb168e457eea490af754922939ebdb920706798455f90ed993f8dac8075fc1538738a25f0c928da905c0dffd81869fa18391ee25ac526ca3e3310d295a3801e9b67d4cd0c8fbf3715b840f7229bd4ca2b4d048d74ba4392342fcd8decf07742556ec7fae4eb17ff51e181f94fcfb48d143bf633750b17355486194a660c7cf29c7c05130a47fa78fde5cd2897e236f900000000000000000000000000000000000000000000000000000000000000010256b632931c5e49b3c7aae3c9cca52ea35deafb12d4cd29ac96341c4ffffffb00000000000000000000000000000000000000000000000000000000000000001ced80673868b95a4e1e17b846881eedfd35ab926b3a90f6390a8af8027678e617deb519a568cd1e54da8d268b86077d4e3d1cbe735d60461ac36a99654bca9000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c068796472612d73332e310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000004c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000007cccd0183c6ca02e76600996a671a824000000000000000000000000000000006c617465737400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c009add86b6daa5011b8d13f3fc7b30a36412f30e55163519825119261fe769f182c50fe65cdd7094e98a8ff818975ee2280df7d1043b256442d9817233ab9ad6917715e4c7f1afe893801288750c8fc278d8a144518a93e1238ac4be7f50526b4132a4e24d08339c6bd22e6f791ee5f2543d8e0a7c8b309017c8f39b6e134da9a05a494966b704b467cb3b6c91d8e37af94173d6e1b68931c7a74ebc287aa0f63117015cb66a82f11cfd4d573c1b63641a5c89f6f218905411697bb660b8c9b3828ad5934e7c6fa4677a749987e50d5e55cf2b4f26db50ba78ea1373eb163bcfc082daee66c8e03721451e1654a2c42c5b6b9e1d340b80dd6c221c1ed5d24c968000000000000000000000000000000000000000000000000000000000000000002b8a512b4aaebb2955485bc52ef1c2957ab167b3784a33ff5dff93ce2cc8e8b07f6c5612eb579788478789deccb06cf0eb168e457eea490af754922939ebdb920706798455f90ed993f8dac8075fc1538738a25f0c928da905c0dffd81869fa18391ee25ac526ca3e3310d295a3801e9b67d4cd0c8fbf3715b840f7229bd4ca15f0c9d010d22cbd1a93eb450fb1c5189d696a739c5d9fb92eea292854b658c60b60307b2601517d751fe508d666838676b02e581a6bb9c3888e6ca33f98a4a700000000000000000000000000000000000000000000000000000000000000011c0433327a095fdb05bf7e29a36ef76a1bf9a3d480011edd783c14d81ffffffe00000000000000000000000000000000000000000000000000000000000000001ced80673868b95a4e1e17b846881eedfd35ab926b3a90f6390a8af8027678e617deb519a568cd1e54da8d268b86077d4e3d1cbe735d60461ac36a99654bca90000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
    // the appId from the Sismo Connect App we want to use
    bool isImpersonationMode = false; // <--- set to true to allow verifying proofs from impersonated accounts
    // sismo dataGroupIds
    bytes16 public constant TEAM_MEMBERS_GROUP_ID = 0xf44c3e70f9147f1a4d59077451535f00;
    bytes16 public constant G2M_GROUP_ID = 0x7cccd0183c6ca02e76600996a671a824;

    // bytes16 public constant DATA_GROUP_ID = 0x6d6ab4793a05fbdafbb8895f8e9eef14; // ten eths group

    // sismo appId
    bytes16 public constant APP_ID = 0x1267ea070ec44221e85667a731eee045;
    uint256 public constant REFRESH_DURATION = 7 days;

    address public owner = 0xb5AB443DfF53F0e397a9E0778A3343Cbaf4D001a;
    address public account = 0xb5AB443DfF53F0e397a9E0778A3343Cbaf4D001a;

    function setUp() public {
        _registerTreeRoot(0x04f0ace60fdf560415b93173156e67c6735946e9889973bfd56f1bcbe6fc5bcf);
        vm.startPrank(owner);
        DataTypes.GroupSetup[] memory groups = new DataTypes.GroupSetup[](2);
        groups[0] = (DataTypes.GroupSetup({groupId: TEAM_MEMBERS_GROUP_ID, startAt: 1000, duration: 1 days}));
        groups[1] = (DataTypes.GroupSetup({groupId: G2M_GROUP_ID, startAt: 12000, duration: 1 days}));

        sismoCredential = new SismoCredential(
            owner,
            APP_ID,
            REFRESH_DURATION,
            isImpersonationMode,
            groups
        );
        vm.stopPrank();
    }

    function test_setRefreshDuration() public {
        assertEq(sismoCredential.getRefreshDuration(), REFRESH_DURATION);

        uint256 newDuration = REFRESH_DURATION * 2;

        vm.prank(owner);
        sismoCredential.setRefreshDuration(newDuration);

        assertEq(sismoCredential.getRefreshDuration(), newDuration);
    }

    function test_addDataGroups() public {
        bytes16 mockGroupId_01 = 0x7cccd0183c6ca02e76600996a6710001;
        bytes16 mockGroupId_02 = 0x7cccd0183c6ca02e76600996a6710002;

        DataTypes.GroupSetup[] memory groups = new DataTypes.GroupSetup[](2);
        groups[0] = (DataTypes.GroupSetup({groupId: mockGroupId_01, startAt: 1000, duration: 1 days}));

        groups[1] = (DataTypes.GroupSetup({groupId: mockGroupId_02, startAt: 12000, duration: 1 days}));

        vm.prank(owner);
        sismoCredential.addDataGroups(groups);

        assertEq(sismoCredential.getGroupIds()[2], mockGroupId_01);
        assertEq(sismoCredential.getGroupIds()[3], mockGroupId_02);
    }

    function test_deleteDataGroups() public {
        bytes16[] memory groupIds = new bytes16[](2);
        groupIds[0] = TEAM_MEMBERS_GROUP_ID;
        groupIds[1] = G2M_GROUP_ID;

        vm.prank(owner);
        sismoCredential.deleteDataGroups(groupIds);

        uint256 num = sismoCredential.getGroupIds().length;
        assertEq(num, 0);
    }

    function test_bindCredential() public {
        vm.prank(account);
        sismoCredential.bindCredential(account, response);

        DataTypes.CredentialInfo[] memory reps = sismoCredential.getCredentialInfoList(account);

        uint256 expiredAt = block.timestamp + 1 days - ((block.timestamp - 1000) % 1 days);
        assertEq(reps[0].groupId, TEAM_MEMBERS_GROUP_ID);
        assertEq(reps[0].value, true);
        assertEq(reps[0].expiredAt, expiredAt);

        assertEq(reps[1].groupId, G2M_GROUP_ID);
        assertEq(reps[1].value, false);
        assertEq(reps[1].expiredAt, 0);

        vm.warp(block.timestamp + REFRESH_DURATION);

        vm.prank(account);
        sismoCredential.bindCredential(account, response3);

        reps = sismoCredential.getCredentialInfoList(account);

        expiredAt = block.timestamp + 1 days - ((block.timestamp - 1000) % 1 days);
        assertEq(reps[0].groupId, TEAM_MEMBERS_GROUP_ID);
        assertEq(reps[0].value, true);
        assertEq(reps[0].expiredAt, expiredAt);

        expiredAt = block.timestamp + 1 days - ((block.timestamp - 12000) % 1 days);
        assertEq(reps[1].groupId, G2M_GROUP_ID);
        assertEq(reps[1].value, true);
        assertEq(reps[1].expiredAt, expiredAt);

        bytes16[] memory groupIds = new bytes16[](1);
        groupIds[0] = TEAM_MEMBERS_GROUP_ID;

        vm.prank(owner);
        sismoCredential.deleteDataGroups(groupIds);

        uint256 num = sismoCredential.getGroupIds().length;
        assertEq(num, 1);

        reps = sismoCredential.getCredentialInfoList(account);

        expiredAt = block.timestamp + 1 days - ((block.timestamp - 12000) % 1 days);
        assertEq(reps[0].groupId, G2M_GROUP_ID);
        assertEq(reps[0].value, true);
        assertEq(reps[0].expiredAt, expiredAt);

        // add groupId
        DataTypes.GroupSetup[] memory groups = new DataTypes.GroupSetup[](1);
        groups[0] = (DataTypes.GroupSetup({groupId: TEAM_MEMBERS_GROUP_ID, startAt: 1000, duration: 1 days}));

        vm.prank(owner);
        sismoCredential.addDataGroups(groups);
        assertEq(sismoCredential.getGroupIds()[1], TEAM_MEMBERS_GROUP_ID);

        reps = sismoCredential.getCredentialInfoList(account);

        expiredAt = block.timestamp + 1 days - ((block.timestamp - 12000) % 1 days);
        assertEq(reps[0].groupId, G2M_GROUP_ID);
        assertEq(reps[0].value, true);
        assertEq(reps[0].expiredAt, expiredAt);

        expiredAt = block.timestamp + 1 days - ((block.timestamp - 1000) % 1 days);
        assertEq(reps[1].groupId, TEAM_MEMBERS_GROUP_ID);
        assertEq(reps[1].value, true);
        assertEq(reps[1].expiredAt, expiredAt);
    }

    function test_getCredential() public {
        vm.prank(account);
        sismoCredential.bindCredential(account, response);

        uint256 expiredAt = block.timestamp + 1 days - ((block.timestamp - 1000) % 1 days);

        vm.warp(block.timestamp + 100 days);
        DataTypes.CredentialInfo[] memory reps = sismoCredential.getCredentialInfoList(account);

        assertEq(reps[0].groupId, TEAM_MEMBERS_GROUP_ID);
        assertEq(reps[0].value, false);
        assertEq(reps[0].expiredAt, expiredAt);

        assertEq(reps[1].groupId, G2M_GROUP_ID);
        assertEq(reps[1].value, false);
        assertEq(reps[1].expiredAt, 0);
    }

    function test_getCredentialInfoList_should_not_return_deleted_credential() public {
        vm.prank(account);
        sismoCredential.bindCredential(account, response);
        uint256 expiredAt = block.timestamp + 1 days - ((block.timestamp - 1000) % 1 days);

        vm.warp(block.timestamp + 100 days);

        DataTypes.CredentialInfo[] memory reps = sismoCredential.getCredentialInfoList(account);

        assertEq(reps[0].groupId, TEAM_MEMBERS_GROUP_ID);
        assertEq(reps[0].value, false);
        assertEq(reps[0].expiredAt, expiredAt);

        assertEq(reps[1].groupId, G2M_GROUP_ID);
        assertEq(reps[1].value, false);
        assertEq(reps[1].expiredAt, 0);

        bytes16[] memory groupIds = new bytes16[](1);
        groupIds[0] = TEAM_MEMBERS_GROUP_ID;

        vm.prank(account);
        sismoCredential.deleteDataGroups(groupIds);
        reps = sismoCredential.getCredentialInfoList(account);
        assertEq(reps[0].groupId, G2M_GROUP_ID);
        assertEq(reps[0].value, false);
        assertEq(reps[0].expiredAt, 0);
    }
}
